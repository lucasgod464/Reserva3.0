<!DOCTYPE html>
    <html lang="pt-br">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Reserva de Rod√≠zio</title>
        <link rel="stylesheet" href="src/base.css">
        <link rel="stylesheet" href="src/form.css">
        <link rel="stylesheet" href="src/coupon.css">
        <link rel="stylesheet" href="src/address.css">
        <link rel="stylesheet" href="src/payment.css">
        <link rel="stylesheet" href="src/file-upload.css">
        <link rel="stylesheet" href="src/button.css">
        <link rel="stylesheet" href="src/person-fields.css">
    </head>
    <body>
        <div class="container">
            <h1 class="title">Fazer Reserva</h1>

            <div class="form">
                <div class="inputGroup">
                    <label class="label">N√∫mero de Pessoas:</label>
                    <input type="number" id="numPessoas" min="1" class="input" required>
                </div>

                <div id="person-fields">
                  <label class="label">Nome do Respons√°vel:</label>
                  <input type="text" id="nomeResponsavel" placeholder="Nome do Respons√°vel" class="input" required>
                </div>

                <div class="inputGroup">
                    <label class="label">Telefone:</label>
                    <input type="tel" id="telefone" placeholder="Telefone" class="input" required>
                </div>

                <div class="cupomContainer" id="cupomContainer">
                    <button class="mostrarCupomButton" onclick="showCupomInput()">Tem um cupom de desconto?</button>
                </div>
            </div>

            <div class="addressContainer">
                <h3 class="addressTitle">Local do Rod√≠zio</h3>
                <p class="addressText">Endere√ßo: Rua Juiz David Barrilli, 376 - Jardim Aquarius, S√£o Jos√© dos Campos - SP, 12246-200</p>
                <div class="addressButtons">
                    <button class="addressButton" onclick="openGoogleMaps()">Abrir no Google Maps</button>
                    <button class="addressButton" onclick="copyAddress()">Copiar Endere√ßo</button>
                </div>
            </div>

            <div class="pagamentoContainer">
                <h3 class="pagamentoTitle">Informa√ß√µes de Pagamento</h3>
                <div class="pagamentoInfo">
                    <p class="valorTotal">Valor Total: R$ 104.85</p>
                    <p class="instrucao">Para finalizar sua reserva, siga os passos abaixo:</p>
                </div>

                <div class="passos">
                    <div class="passo">
                        <span class="passoNumero">1</span>
                        <div class="passoConteudo">
                            <h4 class="passoTitulo">Realize o Pagamento via PIX</h4>
                            <div class="pixContainer">
                                <p class="pixInfo"><strong>Tipo de Chave:</strong> CPF</p>
                                <div class="pixInputContainer">
                                    <input class="pixInput" id="pixKeyInput" value="46002748814" readonly>
                                    <button class="copyButton" onclick="copyPix()">Copiar</button>
                                </div>
                                <div class="copyIndicator">
                                    <span class="copyIcon">üìã</span>
                                    Clique para copiar a chave PIX
                                </div>
                            </div>
                            <div class="aviso" id="pixCopiedMessage">
                                <span class="avisoIcon">‚úÖ</span>
                                Chave PIX copiada!
                            </div>
                        </div>
                    </div>

                    <div class="passo">
                        <span class="passoNumero">2</span>
                        <div class="passoConteudo">
                            <h4 class="passoTitulo">Envie o Comprovante de Pagamento</h4>
                            <div class="inputGroup">
                                <label class="fileInputLabel" for="comprovante">
                                    Selecione o arquivo do comprovante
                                </label>
                                <input type="file" id="comprovante" class="fileInput" accept="image/*,application/pdf" required>
                            </div>
                            <p class="comprovanteInstrucao">Formatos aceitos: imagens e PDF</p>
                        </div>
                    </div>
                </div>
            </div>

            <button type="submit" class="button" onclick="submitForm()">Finalizar Reserva</button>
        </div>
        <script type="module">
            import { createClient } from '@supabase/supabase-js'

            const supabaseUrl = 'https://atvykyxlxntwaiphwrja.supabase.co'
            const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImF0dnlreXhseG50d2FpcGh3cmphIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzcxNTc0NjEsImV4cCI6MjA1MjczMzQ2MX0.WdllwJFqGby2dIOOemC6ZOb2zr6bhZOTMZYwXn1DD7U'
            const supabase = createClient(supabaseUrl, supabaseKey)

            const numPessoasInput = document.getElementById('numPessoas');
            const personFieldsDiv = document.getElementById('person-fields');
            const nomeResponsavelInput = document.getElementById('nomeResponsavel');
            const address = "Rua Juiz David Barrilli, 376 - Jardim Aquarius, S√£o Jos√© dos Campos - SP, 12246-200";
            const pixKey = "46002748814";
            const pixCopiedMessage = document.getElementById('pixCopiedMessage');
            const cupomContainer = document.getElementById('cupomContainer');

            function generatePersonFields() {
                personFieldsDiv.innerHTML = '';

                const numPessoas = parseInt(numPessoasInput.value, 10);

                const nomeResponsavelLabel = document.createElement('label');
                nomeResponsavelLabel.textContent = 'Nome do Respons√°vel:';
                nomeResponsavelLabel.classList.add('label');
                nomeResponsavelLabel.setAttribute('for', 'nomeResponsavel');

                personFieldsDiv.appendChild(nomeResponsavelLabel);
                personFieldsDiv.appendChild(nomeResponsavelInput);

                for (let i = 2; i <= numPessoas; i++) {
                    const personDiv = document.createElement('div');
                    personDiv.classList.add('inputGroup', 'destaque');
                    const label = document.createElement('label');
                    label.textContent = `Nome da Pessoa ${i}:`;
                    label.classList.add('label');
                    const input = document.createElement('input');
                    input.type = 'text';
                    input.placeholder = `Nome da Pessoa ${i}`;
                    input.classList.add('input');

                    const childDiv = document.createElement('div');
                    const childLabel = document.createElement('label');
                    childLabel.textContent = 'Crian√ßa:';
                    childLabel.classList.add('checkboxLabel');
                    const childSelect = document.createElement('select');
                    childSelect.id = `crianca${i}`;
                    const option1 = document.createElement('option');
                    option1.value = '';
                    option1.text = 'N√£o';
                    const option2 = document.createElement('option');
                    option2.value = 'ate5';
                    option2.text = 'At√© 5 anos';
                    const option3 = document.createElement('option');
                    option3.value = '6a10';
                    option3.text = '6 a 10 anos';
                    childSelect.appendChild(option1);
                    childSelect.appendChild(option2);
                    childSelect.appendChild(option3);

                    childDiv.appendChild(childLabel);
                    childDiv.appendChild(childSelect);

                    personDiv.appendChild(label);
                    personDiv.appendChild(input);
                    personDiv.appendChild(childDiv);
                    personFieldsDiv.appendChild(personDiv);
                }
            }

            numPessoasInput.addEventListener('change', generatePersonFields);
            generatePersonFields();

            function openGoogleMaps() {
              const encodedAddress = encodeURIComponent(address);
              window.open(`https://www.google.com/maps/search/?api=1&query=${encodedAddress}`, '_blank');
            }

            function copyAddress() {
              navigator.clipboard.writeText(address)
                .then(() => alert('Endere√ßo copiado!'))
                .catch(err => console.error('Erro ao copiar endere√ßo: ', err));
            }

            function copyPix() {
              navigator.clipboard.writeText(pixKey)
                .then(() => {
                  pixCopiedMessage.style.display = 'flex';
                  setTimeout(() => {
                    pixCopiedMessage.style.display = 'none';
                  }, 3000);
                })
                .catch(err => console.error('Erro ao copiar chave PIX: ', err));
            }

            function showCupomInput() {
                cupomContainer.innerHTML = `
                    <div class="cupomInputContainer">
                        <input type="text" class="cupomInput" placeholder="Digite seu cupom">
                        <button class="aplicarCupomButton">Aplicar</button>
                    </div>
                `;
            }

            async function submitForm() {
              const numPessoas = document.getElementById('numPessoas').value;
              const nomeResponsavel = document.getElementById('nomeResponsavel').value;
              const telefone = document.getElementById('telefone').value;
              const pessoas = [];

              for (let i = 2; i <= numPessoas; i++) {
                const nomePessoa = document.querySelector(`#person-fields div:nth-child(${i}) input[type="text"]`).value;
                const crianca = document.querySelector(`#person-fields div:nth-child(${i}) select`).value;
                pessoas.push({ nome: nomePessoa, crianca });
              }

              const { data, error } = await supabase
                .from('reservas')
                .insert([
                  {
                    num_pessoas: numPessoas,
                    nome_responsavel: nomeResponsavel,
                    telefone: telefone,
                    pessoas: pessoas,
                  },
                ])
                if (error) {
                  console.error('Erro ao inserir dados:', error);
                  alert('Erro ao enviar reserva. Por favor, tente novamente.');
                } else {
                  console.log('Dados inseridos com sucesso:', data);
                  alert('Reserva enviada com sucesso!');
                }
            }
        </script>
    </body>
    </html>
